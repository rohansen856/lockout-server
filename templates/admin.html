<!DOCTYPE html>
<html>
<head>
    <title>Contest Admin</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 8px; }
        button { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        .question-section, .player-section { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; }
        .time-completed { display: flex; gap: 20px; }
        .time-completed label { display: flex; align-items: center; gap: 5px; }
        .players-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    </style>
</head>
<body>
    <h1>Contest Data Admin</h1>
    <form id="dataForm">
        <div class="form-group">
            <label>Contest ID:</label>
            <input type="text" id="contestId" value="{{ data.contestId }}" required>
        </div>

        <h2>Players</h2>
        <div class="players-container">
            <!-- Player 1 -->
            <div class="player-section">
                <h3>Player 1</h3>
                <div class="form-group">
                    <label>ID:</label>
                    <input type="text" id="player1Id" value="{{ data.players.player1.id }}" required>
                </div>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="player1Name" value="{{ data.players.player1.name }}" required>
                </div>
                <div class="form-group">
                    <label>Image URL:</label>
                    <input type="url" id="player1Image" value="{{ data.players.player1.imageUrl }}" required>
                </div>
                <div class="form-group">
                    <label>Rating:</label>
                    <input type="number" id="player1Rating" value="{{ data.players.player1.rating }}" required>
                </div>
                <div class="form-group">
                    <label>Rank:</label>
                    <input type="text" id="player1Rank" value="{{ data.players.player1.rank }}" required>
                </div>
                <div class="form-group">
                    <label>Solved Count:</label>
                    <input type="number" id="player1SolvedCount" value="{{ data.players.player1.solvedCount }}" required>
                </div>
                <div class="form-group">
                    <label>Country:</label>
                    <input type="text" id="player1Country" value="{{ data.players.player1.country }}" required>
                </div>
                <div class="form-group">
                    <label>Profile:</label>
                    <input type="text" id="player1Profile" value="{{ data.players.player1.profile }}" required>
                </div>
            </div>

            <!-- Player 2 -->
            <div class="player-section">
                <h3>Player 2</h3>
                <div class="form-group">
                    <label>ID:</label>
                    <input type="text" id="player2Id" value="{{ data.players.player2.id }}" required>
                </div>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="player2Name" value="{{ data.players.player2.name }}" required>
                </div>
                <div class="form-group">
                    <label>Image URL:</label>
                    <input type="url" id="player2Image" value="{{ data.players.player2.imageUrl }}" required>
                </div>
                <div class="form-group">
                    <label>Rating:</label>
                    <input type="number" id="player2Rating" value="{{ data.players.player2.rating }}" required>
                </div>
                <div class="form-group">
                    <label>Rank:</label>
                    <input type="text" id="player2Rank" value="{{ data.players.player2.rank }}" required>
                </div>
                <div class="form-group">
                    <label>Solved Count:</label>
                    <input type="number" id="player2SolvedCount" value="{{ data.players.player2.solvedCount }}" required>
                </div>
                <div class="form-group">
                    <label>Country:</label>
                    <input type="text" id="player2Country" value="{{ data.players.player2.country }}" required>
                </div>
                <div class="form-group">
                    <label>Profile:</label>
                    <input type="text" id="player2Profile" value="{{ data.players.player2.profile }}" required>
                </div>
            </div>
        </div>

        <h2>Scores</h2>
        <div class="form-group">
            <label>Player 1 Score:</label>
            <input type="number" id="player1Score" value="{{ data.score.player1 }}" required>
        </div>
        <div class="form-group">
            <label>Player 2 Score:</label>
            <input type="number" id="player2Score" value="{{ data.score.player2 }}" required>
        </div>
        <div class="form-group">
            <label>Max Score:</label>
            <input type="number" id="maxScore" value="{{ data.score.maxScore }}" required>
        </div>

        <h2>Questions</h2>
        <div id="questionsContainer">
            {% for question in data.questions %}
            <div class="question-section">
                <h3>Question {{ loop.index }}</h3>
                <input type="hidden" class="qId" value="{{ question.id }}">
                
                <div class="form-group">
                    <label>Title:</label>
                    <input type="text" class="qTitle" value="{{ question.title }}" required>
                </div>
                
                <div class="form-group">
                    <label>Description:</label>
                    <textarea class="qDescription" rows="4" required>{{ question.description }}</textarea>
                </div>
                
                <div class="form-group">
                    <label>Difficulty:</label>
                    <select class="qDifficulty">
                        <option value="Easy" {% if question.difficulty == 'Easy' %}selected{% endif %}>Easy</option>
                        <option value="Medium" {% if question.difficulty == 'Medium' %}selected{% endif %}>Medium</option>
                        <option value="Hard" {% if question.difficulty == 'Hard' %}selected{% endif %}>Hard</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Points:</label>
                    <input type="number" class="qPoints" value="{{ question.points }}" required>
                </div>
                
                <div class="form-group">
                    <label>Player 1 Status:</label>
                    <select class="qStatusP1">
                        <option value="solved" {% if question.status.player1 == 'solved' %}selected{% endif %}>Solved</option>
                        <option value="attempting" {% if question.status.player1 == 'attempting' %}selected{% endif %}>Attempting</option>
                        <option value="not_started" {% if question.status.player1 == 'not_started' %}selected{% endif %}>Not Started</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Player 2 Status:</label>
                    <select class="qStatusP2">
                        <option value="solved" {% if question.status.player2 == 'solved' %}selected{% endif %}>Solved</option>
                        <option value="attempting" {% if question.status.player2 == 'attempting' %}selected{% endif %}>Attempting</option>
                        <option value="not_started" {% if question.status.player2 == 'not_started' %}selected{% endif %}>Not Started</option>
                    </select>
                </div>
                
                <div class="time-completed">
                    <div>
                        <label>
                            <input type="checkbox" class="qTimeP1" {% if question.timeCompleted.player1 %}checked{% endif %}>
                            Player 1 Time Completed
                        </label>
                    </div>
                    <div>
                        <label>
                            <input type="checkbox" class="qTimeP2" {% if question.timeCompleted.player2 %}checked{% endif %}>
                            Player 2 Time Completed
                        </label>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <button type="submit">Update Contest Data</button>
    </form>

    <script>
        const socket = io('http://localhost:5000');
        
        document.getElementById('dataForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const data = {
                contestId: document.getElementById('contestId').value,
                player1: {
                    id: document.getElementById('player1Id').value,
                    name: document.getElementById('player1Name').value,
                    imageUrl: document.getElementById('player1Image').value,
                    rating: document.getElementById('player1Rating').value,
                    rank: document.getElementById('player1Rank').value,
                    solvedCount: document.getElementById('player1SolvedCount').value,
                    country: document.getElementById('player1Country').value,
                    profile: document.getElementById('player1Profile').value
                },
                player2: {
                    id: document.getElementById('player2Id').value,
                    name: document.getElementById('player2Name').value,
                    imageUrl: document.getElementById('player2Image').value,
                    rating: document.getElementById('player2Rating').value,
                    rank: document.getElementById('player2Rank').value,
                    solvedCount: document.getElementById('player2SolvedCount').value,
                    country: document.getElementById('player2Country').value,
                    profile: document.getElementById('player2Profile').value
                },
                player1Score: document.getElementById('player1Score').value,
                player2Score: document.getElementById('player2Score').value,
                maxScore: document.getElementById('maxScore').value,
                questions: []
            };

            // Collect question data
            document.querySelectorAll('.question-section').forEach(qSection => {
                const question = {
                    id: qSection.querySelector('.qId').value,
                    title: qSection.querySelector('.qTitle').value,
                    description: qSection.querySelector('.qDescription').value,
                    difficulty: qSection.querySelector('.qDifficulty').value,
                    points: qSection.querySelector('.qPoints').value,
                    status: {
                        player1: qSection.querySelector('.qStatusP1').value,
                        player2: qSection.querySelector('.qStatusP2').value
                    },
                    timeCompleted: {
                        player1: qSection.querySelector('.qTimeP1').checked,
                        player2: qSection.querySelector('.qTimeP2').checked
                    }
                };
                data.questions.push(question);
            });

            socket.emit('update_data', data);
        });

        // Optional: Listen for updates from server
        socket.on('contest_update', (data) => {
            console.log('Received updated data:', data);
            // You could update the form here if needed
        });
    </script>
</body>
</html>
